# 常用词粤语拼音学习系统 - 项目架构设计文档

## 项目边界定义

### 必须实现的核心功能
1. **单页面应用架构**：仅保留章节学习功能，移除其他复杂功能
2. **章节式学习**：10个章节，每个章节约800个汉字
3. **真实字频排序**：汉字按日常使用频率排序，最常用字在前
4. **粤语发音系统**：支持点击播放预录制的粤语发音
5. **响应式设计**：适配桌面和移动设备
6. **GitHub Pages部署**：静态网站托管，零成本运维

### 绝对不实现的功能
1. 多页面导航（全屏学习、分章节学习等）
2. 测验和进度跟踪系统
3. 用户账户和登录系统
4. 复杂的数据可视化
5. 服务器端逻辑（纯静态网站）

## 核心数据模型 (ER)

| 表名 | 字段名 | 数据类型 | 主键/外键 | 约束规则 | 备注 |
|------|--------|----------|-----------|----------|------|
| chapters | id | INTEGER | PK | NOT NULL, AUTOINCREMENT | 章节ID |
| chapters | title | TEXT | - | NOT NULL | 章节标题 |
| chapters | start_rank | INTEGER | - | NOT NULL | 起始排名 |
| chapters | end_rank | INTEGER | - | NOT NULL | 结束排名 |
| characters | id | INTEGER | PK | NOT NULL, AUTOINCREMENT | 汉字ID |
| characters | char | TEXT | - | NOT NULL, UNIQUE | 汉字字符 |
| characters | jyutping | TEXT | - | NOT NULL | 粤语拼音 |
| characters | frequency_rank | INTEGER | - | NOT NULL | 字频排名 |
| characters | chapter_id | INTEGER | FK | NOT NULL | 所属章节 |
| audio_files | character | TEXT | PK | NOT NULL | 汉字字符 |
| audio_files | file_path | TEXT | - | NOT NULL | 音频文件路径 |
| audio_files | format | TEXT | - | NOT NULL | 音频格式 |

## 核心API契约

### 1. 获取章节列表
- **HTTP Method**: GET
- **Endpoint URL**: `/data/chapters.json`
- **Request Body**: 无
- **Response Structure**:
```json
[
  {
    "id": 1,
    "title": "第1章",
    "start_rank": 1,
    "end_rank": 811
  },
  {
    "id": 2,
    "title": "第2章",
    "start_rank": 812,
    "end_rank": 1622
  }
]
```

### 2. 获取章节汉字
- **HTTP Method**: GET
- **Endpoint URL**: `/data/chapter_{id}_characters.json`
- **Request Body**: 无
- **Response Structure**:
```json
[
  {
    "char": "的",
    "jyutping": "dik1",
    "frequency_rank": 1
  },
  {
    "char": "是",
    "jyutping": "si6",
    "frequency_rank": 2
  }
]
```

### 3. 播放发音
- **HTTP Method**: GET
- **Endpoint URL**: `/audio/single_chars/{character}.mp3`
- **Request Body**: 无
- **Response Structure**: MP3音频文件流

### 统一异常代码规范
| 错误代码 | 描述 | HTTP状态码 |
|----------|------|------------|
| 1001 | 数据加载失败 | 500 |
| 1002 | 音频文件不存在 | 404 |
| 1003 | 发音系统未初始化 | 400 |
| 1004 | 浏览器不支持音频格式 | 400 |
| 1005 | 网络请求失败 | 503 |

## 开发里程碑

### 第一阶段：基础架构搭建 (已完成)
- [x] 设计单页面应用架构
- [x] 创建模块化JavaScript结构
- [x] 实现数据加载和管理系统
- [x] 设计响应式CSS布局
- [x] 部署到GitHub Pages

### 第二阶段：音频系统优化 (已完成)
- [x] 诊断音频格式兼容性问题
- [x] 批量转换AIFF-C格式为MP3格式
- [x] 实现并行处理优化（16线程）
- [x] 完成7993个音频文件转换（44.49秒）
- [x] 修复发音系统错误检测逻辑

### 第三阶段：字频排序系统 (已完成)
- [x] 分析现有排序方式（笔画排序）
- [x] 研究真实字频数据来源
- [x] 实现基于语料库的字频排序算法
- [x] 创建频率分布统计报告
- [x] 验证排序正确性

### 第四阶段：用户体验优化 (进行中)
- [ ] 修复返回按钮功能
- [ ] 优化移动端体验
- [ ] 添加加载状态指示器
- [ ] 实现离线缓存支持
- [ ] 性能优化和代码压缩

## 技术栈选择

### 前端技术栈
- **核心框架**: 原生JavaScript (无框架依赖)
- **CSS框架**: 自定义CSS，无外部依赖
- **图标库**: Font Awesome 6.0.0 CDN
- **字体**: 系统默认字体栈
- **构建工具**: 无构建步骤，直接部署

### 数据处理技术栈
- **数据格式**: JSON
- **音频处理**: ffmpeg (批量转换)
- **排序算法**: Python 3.9+
- **频率数据**: 现代汉语语料库字频统计

### 部署技术栈
- **托管平台**: GitHub Pages
- **域名**: 免费GitHub Pages域名
- **SSL证书**: GitHub Pages自动提供
- **CDN**: GitHub Pages全球CDN

## 模块架构设计

### 1. DataManager 模块
- **职责**: 数据加载、缓存、管理
- **核心方法**:
  - `loadChapters()`: 加载章节列表
  - `loadChapterCharacters(chapterId)`: 加载章节汉字
  - `getCharacterAudioPath(character)`: 获取音频路径

### 2. PronunciationSystem 模块
- **职责**: 发音播放、格式检测、回退机制
- **核心方法**:
  - `initialize()`: 初始化发音系统
  - `playPronunciation(character)`: 播放指定汉字发音
  - `checkAudioFormatSupport()`: 检测音频格式支持

### 3. UIRenderer 模块
- **职责**: UI渲染、事件绑定、状态管理
- **核心方法**:
  - `renderChapterList(chapters)`: 渲染章节列表
  - `renderCharacterCards(characters)`: 渲染汉字卡片
  - `showLoadingState()`: 显示加载状态
  - `showErrorState(message)`: 显示错误状态

### 4. App 模块
- **职责**: 应用初始化、模块协调、路由管理
- **核心方法**:
  - `init()`: 应用初始化
  - `showChapterList()`: 显示章节列表
  - `showChapterContent(chapterId)`: 显示章节内容
  - `handleBackToChapters()`: 处理返回章节列表

## 字频排序算法设计

### 排序权重分配
1. **真实语料库频率** (70%)
   - 基于现代汉语语料库统计
   - 频率越高，优先级越高

2. **笔画数调整** (20%)
   - 笔画越少，优先级越高
   - 平衡频率和书写难度

3. **拼音常见度** (5%)
   - 常见声母韵母加分
   - 提高发音学习效率

4. **语义领域分析** (5%)
   - 日常词汇优先级高
   - 专业术语优先级低

### 频率分布统计
- **非常高频率** (>50000): 39字 (0.5%)
- **高频率** (10000-50000): 200字 (2.5%)
- **中频率** (1000-10000): 202字 (2.5%)
- **低频率** (100-1000): 6211字 (76.6%)
- **非常低频率** (<100): 1453字 (17.9%)

### 前10个最常用汉字
1. 的 (dik1) - 排名: 1
2. 是 (si6) - 排名: 2
3. 在 (zoi6) - 排名: 3
4. 不 (bat1) - 排名: 4
5. 有 (jau5) - 排名: 5
6. 这 (ze5) - 排名: 6
7. 国 (gwok3) - 排名: 7
8. 我 (ngo5) - 排名: 8
9. 要 (jiu3) - 排名: 9
10. 他 (taa1) - 排名: 10

## 性能优化策略

### 1. 音频文件优化
- **格式转换**: AIFF-C → MP3 (兼容性)
- **并行处理**: 16线程批量转换
- **文件大小**: 平均每个文件~50KB
- **总大小**: ~400MB (7993个文件)

### 2. 数据加载优化
- **按需加载**: 仅加载当前章节数据
- **JSON压缩**: 移除不必要空格
- **缓存策略**: 浏览器本地缓存

### 3. 渲染性能优化
- **虚拟滚动**: 大量数据时使用
- **懒加载**: 图片和音频按需加载
- **CSS优化**: 减少重绘和回流

### 4. 网络优化
- **CDN加速**: GitHub Pages全球CDN
- **HTTP/2**: 多路复用和头部压缩
- **Gzip压缩**: 文本资源压缩

## 部署架构

### GitHub Pages配置
```yaml
# 仓库设置
- 分支: main
- 目录: / (根目录)
- 自定义域名: 可选
- HTTPS: 强制启用

# 构建配置
- 无构建步骤
- 直接部署静态文件
- 自动SSL证书
```

### 文件结构
```
/
├── index.html              # 主应用入口
├── verify_real_frequency_sorting.html  # 字频验证页面
├── js/
│   ├── data-manager.js     # 数据管理模块
│   ├── pronunciation.js    # 发音系统模块
│   ├── ui-renderer.js      # UI渲染模块
│   └── app.js              # 应用主模块
├── css/
│   └── styles.css          # 主样式文件
├── data/
│   ├── chapters.json       # 章节元数据
│   ├── chapter_1_characters.json  # 第1章汉字
│   ├── ...
│   ├── chapter_10_characters.json # 第10章汉字
│   └── real_frequency_sorting_report.json  # 字频统计报告
├── audio/
│   └── single_chars/       # 音频文件目录
│       ├── 的.mp3
│       ├── 是.mp3
│       └── ... (7993个文件)
├── scripts/
│   ├── real_frequency_sorting.py      # 字频排序脚本
│   ├── apply_frequency_sorting.py     # 应用排序脚本
│   └── convert_audio.py               # 音频转换脚本
└── 项目架构设计文档.md      # 本文档
```

## 维护和扩展指南

### 日常维护
1. **监控访问日志**: GitHub Pages访问统计
2. **检查音频文件**: 定期验证音频文件完整性
3. **更新字频数据**: 每年更新一次字频统计
4. **浏览器兼容性**: 测试主流浏览器兼容性

### 扩展功能
1. **搜索功能**: 添加汉字搜索
2. **收藏功能**: 用户收藏常用字
3. **学习进度**: 简单的学习进度跟踪
4. **导出功能**: 导出学习列表为PDF

### 故障排除
1. **发音失败**: 检查音频文件路径和格式
2. **数据加载失败**: 检查JSON文件格式
3. **UI显示异常**: 检查CSS兼容性
4. **性能问题**: 优化大章节加载

## 版本管理

### 语义版本 (SemVer)
- **主版本号**: 架构重大变更
- **次版本号**: 功能添加，向后兼容
- **修订号**: Bug修复，小改进

### 当前版本: 2.0.0
- **2**: 完全重构为单页面应用
- **0**: 基础功能实现
- **0**: Bug修复和优化

### Git分支策略
- **main**: 生产环境分支
- **develop**: 开发分支
- **feature/**: 功能分支
- **hotfix/**: 紧急修复分支

## 总结

本项目成功实现了从复杂多页面应用到简洁单页面应用的架构重构，重点解决了以下核心问题：

1. **架构简化**: 移除不必要的功能，专注于核心学习体验
2. **音频兼容性**: 批量转换7993个音频文件，解决浏览器兼容性问题
3. **科学排序**: 实现基于真实语料库的字频排序，提高学习效率
4. **零成本部署**: 利用GitHub Pages实现免费、高性能的静态网站托管

系统现在具备以下优势：
- **学习效率高**: 最常用字优先学习
- **用户体验好**: 响应式设计，操作简单
- **维护成本低**: 纯静态网站，无需服务器
- **扩展性强**: 模块化架构，易于添加新功能

这个架构设计充分考虑了单人开发者的维护能力，避免了过度工程化，确保了项目的长期可持续性。