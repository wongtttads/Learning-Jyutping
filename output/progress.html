<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习进度统计</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #667eea;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 1rem;
        }
        
        .progress-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .chapter-progress {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .chapter-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .chapter-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }
        
        .chapter-stats {
            display: flex;
            justify-content: space-between;
            color: #666;
            font-size: 0.9rem;
        }
        
        .quiz-history {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .quiz-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .quiz-info {
            flex: 1;
        }
        
        .quiz-date {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .quiz-score {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .quiz-score.high {
            color: #4CAF50;
        }
        
        .quiz-score.medium {
            color: #FF9800;
        }
        
        .quiz-score.low {
            color: #f44336;
        }
        
        .review-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .review-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .review-char {
            background: #fff3e0;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .review-char:hover {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }
        
        .review-char-text {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .review-char-info {
            font-size: 0.8rem;
            color: #666;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .action-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .action-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .action-btn.danger {
            background: #f44336;
            color: white;
        }
        
        .action-btn.success {
            background: #4CAF50;
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-line"></i> 学习进度统计</h1>
            <p class="subtitle">追踪你的粤语拼音学习历程</p>
        </header>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon" style="color: #667eea;">
                    <i class="fas fa-book"></i>
                </div>
                <div class="stat-value" id="total-characters">0</div>
                <div class="stat-label">已学汉字</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="color: #4CAF50;">
                    <i class="fas fa-redo"></i>
                </div>
                <div class="stat-value" id="total-reviews">0</div>
                <div class="stat-label">总复习次数</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="color: #FF9800;">
                    <i class="fas fa-fire"></i>
                </div>
                <div class="stat-value" id="streak-days">0</div>
                <div class="stat-label">连续学习天数</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="color: #f44336;">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="stat-value" id="avg-score">0%</div>
                <div class="stat-label">平均测验分数</div>
            </div>
        </div>
        
        <div class="progress-section">
            <h2 class="section-title"><i class="fas fa-layer-group"></i> 章节进度</h2>
            <div class="chapter-progress" id="chapter-progress">
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>还没有学习记录</p>
                </div>
            </div>
        </div>
        
        <div class="quiz-history">
            <h2 class="section-title"><i class="fas fa-history"></i> 最近测验</h2>
            <div id="quiz-history">
                <div class="empty-state">
                    <i class="fas fa-clipboard-list"></i>
                    <p>还没有测验记录</p>
                </div>
            </div>
        </div>
        
        <div class="review-section">
            <h2 class="section-title"><i class="fas fa-bell"></i> 需要复习的汉字</h2>
            <div class="review-list" id="review-list">
                <div class="empty-state">
                    <i class="fas fa-check-circle"></i>
                    <p>暂无需要复习的汉字</p>
                </div>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn success" onclick="exportProgress()">
                <i class="fas fa-download"></i> 导出进度
            </button>
            <button class="action-btn danger" onclick="resetProgress()">
                <i class="fas fa-trash"></i> 重置进度
            </button>
        </div>
    </div>
    
    <script src="../scripts/progress_tracker.js"></script>
    <script>
        // HTML转义函数，防止XSS攻击
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function loadStatistics() {
            const stats = window.progressTracker.getStatistics();
            
            document.getElementById('total-characters').textContent = stats.totalCharacters;
            document.getElementById('total-reviews').textContent = stats.totalReviews;
            document.getElementById('streak-days').textContent = stats.streakDays;
            document.getElementById('avg-score').textContent = stats.avgScore + '%';
        }
        
        function loadChapterProgress() {
            const container = document.getElementById('chapter-progress');
            const progress = window.progressTracker.progress.chapterProgress;
            
            const chapters = Object.keys(progress);
            
            if (chapters.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>还没有学习记录</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            chapters.forEach(chapterId => {
                const chapterData = progress[chapterId];
                const card = document.createElement('div');
                card.className = 'chapter-card';
                
                const chapterName = chapterId === 'all' ? '全部章节' : `第${chapterId}章`;
                const lastStudyDate = chapterData.lastStudyDate || '未学习';
                
                // 使用textContent避免XSS
                const titleDiv = document.createElement('div');
                titleDiv.className = 'chapter-title';
                titleDiv.textContent = chapterName;
                
                const statsDiv = document.createElement('div');
                statsDiv.className = 'chapter-stats';
                const span = document.createElement('span');
                span.textContent = `最后学习: ${lastStudyDate}`;
                statsDiv.appendChild(span);
                
                card.appendChild(titleDiv);
                card.appendChild(statsDiv);
                container.appendChild(card);
            });
        }
        
        function loadQuizHistory() {
            const container = document.getElementById('quiz-history');
            const quizzes = window.progressTracker.getRecentQuizResults(10);
            
            if (quizzes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>还没有测验记录</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            quizzes.forEach(quiz => {
                const item = document.createElement('div');
                item.className = 'quiz-item';
                
                const date = new Date(quiz.date).toLocaleString('zh-CN');
                const scoreClass = quiz.percentage >= 80 ? 'high' : quiz.percentage >= 60 ? 'medium' : 'low';
                const chapterText = quiz.chapter === 'all' ? '全部' : `第${quiz.chapter}章`;
                
                // 使用textContent避免XSS
                const infoDiv = document.createElement('div');
                infoDiv.className = 'quiz-info';
                
                const dateDiv = document.createElement('div');
                dateDiv.className = 'quiz-date';
                dateDiv.textContent = date;
                
                const detailDiv = document.createElement('div');
                detailDiv.textContent = `章节: ${chapterText} | 题数: ${quiz.questionCount}`;
                
                infoDiv.appendChild(dateDiv);
                infoDiv.appendChild(detailDiv);
                
                const scoreDiv = document.createElement('div');
                scoreDiv.className = `quiz-score ${scoreClass}`;
                scoreDiv.textContent = `${quiz.percentage}%`;
                
                item.appendChild(infoDiv);
                item.appendChild(scoreDiv);
                container.appendChild(item);
            });
        }
        
        function loadReviewList() {
            const container = document.getElementById('review-list');
            const reviewChars = window.progressTracker.getCharactersNeedingReview();
            
            if (reviewChars.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <p>暂无需要复习的汉字</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            reviewChars.slice(0, 20).forEach(charData => {
                const charDiv = document.createElement('div');
                charDiv.className = 'review-char';
                charDiv.onclick = () => {
                    alert(`汉字: ${charData.char}\n复习次数: ${charData.reviewCount}\n距上次复习: ${charData.daysSinceReview}天`);
                };
                
                // 使用textContent避免XSS
                const textDiv = document.createElement('div');
                textDiv.className = 'review-char-text';
                textDiv.textContent = charData.char;
                
                const infoDiv = document.createElement('div');
                infoDiv.className = 'review-char-info';
                infoDiv.textContent = `${charData.daysSinceReview}天前`;
                
                charDiv.appendChild(textDiv);
                charDiv.appendChild(infoDiv);
                container.appendChild(charDiv);
            });
        }
        
        function exportProgress() {
            window.progressTracker.exportProgress();
        }
        
        function resetProgress() {
            if (window.progressTracker.resetProgress()) {
                alert('进度已重置');
                loadAllData();
            }
        }
        
        function loadAllData() {
            loadStatistics();
            loadChapterProgress();
            loadQuizHistory();
            loadReviewList();
        }
        
        loadAllData();
    </script>
</body>
</html>
